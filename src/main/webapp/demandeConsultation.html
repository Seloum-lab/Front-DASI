<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Demande de Consultation</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    </head>
    <header>
        <h1>Predict'IF</h1>
        <h1>Demande de consultation</h1>
        <div id='profilUtilisateur'></div>
        <a href='dashboard_client.html'>Retour</a>
    </header>
    <body>
        <table id="listeMediums"></table>
        
        <script>
            $(document).ready( function () {
                let xmlhttp = new XMLHttpRequest(); //Construction de la request
                xmlhttp.open("GET", "./ActionServlet?todo=afficherListeMedium", true); //Lancer la requête
                
                xmlhttp.onreadystatechange = function() { //Handler pour la réponse
                    let DONE = 4, OK = 200;
                    if (xmlhttp.readyState === DONE && xmlhttp.status === OK) {
                        console.log("test");
                        let jsonResponse = JSON.parse(xmlhttp.responseText); //parsing du Json
                        //Recuperation des JsonArray
                        // affichage de la liste des mediums
                        let table = $("#listeMediums"); // on get la table dans le document HTML
                        let listeMediums = jsonResponse.listeMediums; 
                        let cte = 0; // compteur pour le nombre de meduims par ligne
                        let ligne = $("<tr></tr>"); // une ligne dans le tableau
                        for(let i = 0; i < listeMediums.length; i++) { // pcq 3 mediums par ligne
                            let uneCase = $("<th></th>");
                            let title = $("<h1></h1>");
                            $(title).text(listeMediums[i].nom);
                            let presentation = $("<p></p>");
                            $(presentation).text(listeMediums[i].presentation);
                            uneCase.append(title);
                            uneCase.append(presentation);
                            $(uneCase).attr('id', listeMediums[i].id); // identifiant de la case est id du medium pour savoir quel medium est selectionne au clique
                            
                            uneCase.on("click", function() {
                                // on veut que lorsqu un medium est clique, mettre son id qui est l id de l element uneCase dans la requete au cas ou l utilisateur demande un rdv avec le medium en question
                                alert("test");
                                // TODO faire le pop up
                                
                            })
                            if(cte === 3) {
                                table.append(ligne); // on ajoute la ligne remplie au tableau
                                ligne = $("<tr></tr>"); // on reprend une nouvelle ligne
                                cte = 0; // reset le compteur
                            }
                            ligne.append(uneCase); // on ajoute la case a la ligne
                            cte++; // on met a jour le nombre de cases dans la ligne
                        }
                        table.append(ligne);
                    }
                };    
                xmlhttp.send(null);   
            });
        </script>
    </body>
</html>
