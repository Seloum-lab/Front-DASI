<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Demande de Consultation</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
        <link rel="stylesheet" type="text/css" href="./CSS/global.css" />
        <link rel="stylesheet" type="text/css" href="./CSS/globalafterconnect.css" />
        <link rel="stylesheet" type="text/css" href="./CSS/demandeconsultation.css" />
    </head>

    <body>
        <div id = "banniere_haut" class = "banniere">
            <h1 id = "Predictif">Predict'IF</h1>
            <h1 id = "titre-page"> Tableau de bord </h1>
            <svg  id = "profil-photo" version="1.0" xmlns="http://www.w3.org/2000/svg"  width="40pt" height="40pt" viewBox="0 0 900.000000 900.000000"  preserveAspectRatio="xMidYMid meet">  <g transform="translate(0.000000,900.000000) scale(0.100000,-0.100000)" fill="#ffffff" stroke="none"> <path d="M4133 8988 c1 -9 -24 -15 -83 -20 -115 -10 -299 -36 -390 -54 -137 -28 -214 -45 -265 -59 -27 -8 -79 -21 -115 -31 -90 -23 -159 -44 -198 -60 -18 -8 -40 -14 -50 -14 -9 0 -26 -7 -36 -15 -11 -8 -28 -15 -38 -15 -9 0 -34 -7 -55 -16 -86 -37 -101 -43 -178 -74 -121 -49 -397 -188 -480 -241 -16 -10 -37 -22 -45 -26 -8 -3 -33 -18 -55 -32 -58 -37 -78 -49 -95 -58 -8 -4 -19 -11 -25 -15 -34 -28 -105 -78 -110 -78 -6 0 -205 -148 -215 -160 -3 -3 -29 -24 -59 -48 -290 -228 -659 -631 -876 -957 -22 -33 -42 -62 -46 -65 -3 -3 -9 -12 -13 -20 -4 -8 -12 -24 -19 -35 -7 -11 -24 -38 -37 -60 -14 -23 -31 -50 -38 -60 -6 -11 -17 -29 -22 -40 -6 -11 -26 -47 -45 -80 -56 -97 -159 -311 -210 -435 -26 -63 -53 -129 -60 -145 -7 -17 -16 -45 -19 -62 -4 -18 -12 -35 -17 -38 -5 -4 -9 -15 -9 -25 0 -11 -6 -34 -14 -52 -16 -39 -37 -108 -60 -198 -10 -36 -23 -87 -31 -115 -30 -108 -70 -309 -89 -450 -33 -238 -38 -356 -33 -715 7 -408 18 -540 59 -735 6 -27 14 -70 18 -95 4 -25 13 -67 20 -95 6 -27 19 -77 27 -110 19 -79 42 -163 55 -200 5 -16 14 -43 18 -60 5 -16 25 -75 45 -130 20 -55 40 -111 45 -125 13 -37 35 -91 50 -125 7 -16 24 -55 38 -85 33 -76 160 -328 182 -365 10 -16 28 -48 40 -70 12 -22 35 -59 51 -83 16 -24 29 -45 29 -47 0 -2 21 -34 47 -72 26 -37 60 -88 77 -113 32 -48 146 -202 156 -210 3 -3 24 -29 48 -59 146 -186 447 -487 633 -633 30 -24 56 -45 59 -48 8 -10 162 -124 210 -156 25 -17 76 -51 113 -77 38 -26 70 -47 72 -47 2 0 23 -13 47 -29 24 -16 61 -39 83 -51 22 -12 54 -30 70 -40 37 -22 289 -149 365 -182 30 -14 69 -31 85 -38 34 -15 88 -37 125 -50 14 -5 70 -25 125 -45 55 -20 114 -40 130 -45 17 -4 44 -13 60 -18 52 -18 142 -41 310 -82 84 -21 186 -39 270 -50 44 -6 87 -13 95 -16 66 -26 805 -44 1035 -25 226 19 518 68 690 116 28 7 79 21 115 30 92 24 160 45 198 61 18 8 40 14 50 14 9 0 26 7 36 15 11 8 28 15 38 15 9 0 32 6 50 14 18 8 85 35 148 61 124 51 338 154 435 210 33 19 69 39 80 45 21 11 34 18 103 63 24 15 45 27 46 27 14 0 375 256 396 280 3 3 30 25 60 49 185 145 487 447 632 632 24 30 45 56 48 59 8 6 152 200 165 222 6 9 33 49 60 90 28 40 52 78 55 83 3 6 17 28 31 50 14 22 29 47 32 55 4 8 16 29 26 45 58 90 193 362 256 515 26 63 53 129 60 145 7 17 16 45 19 62 4 18 12 35 17 38 5 4 9 15 9 25 0 11 6 34 14 52 16 39 37 108 60 198 10 36 23 88 31 115 44 161 95 456 113 655 5 59 11 84 20 82 9 -1 12 78 12 358 0 283 -3 359 -12 357 -9 -1 -15 24 -21 88 -4 50 -12 122 -18 160 -6 39 -15 97 -19 130 -9 67 -32 184 -50 260 -39 163 -64 258 -82 310 -5 17 -14 44 -18 60 -5 17 -25 75 -45 130 -20 55 -40 111 -45 125 -41 115 -212 481 -270 575 -10 17 -28 47 -39 67 -11 21 -33 57 -48 80 -15 24 -30 48 -33 53 -3 6 -27 43 -55 83 -27 41 -54 81 -60 90 -13 22 -157 216 -165 222 -3 3 -24 29 -48 59 -215 274 -615 645 -902 837 -25 17 -76 51 -113 77 -38 26 -70 47 -72 47 -2 0 -23 13 -47 29 -24 16 -61 39 -83 51 -22 12 -53 30 -70 40 -38 23 -291 149 -370 184 -111 50 -120 53 -160 69 -22 8 -58 22 -80 30 -56 22 -184 67 -220 77 -16 4 -43 13 -60 18 -37 13 -121 36 -200 55 -143 35 -162 40 -200 47 -22 4 -67 12 -100 18 -166 30 -247 42 -296 43 -87 1 -154 13 -151 27 1 9 -80 12 -358 12 -280 0 -359 -3 -357 -12z m722 -657 c209 -17 554 -83 700 -133 17 -5 46 -14 65 -18 19 -4 51 -14 70 -20 86 -31 108 -39 150 -55 25 -9 59 -23 75 -30 17 -7 50 -20 75 -30 58 -23 356 -170 395 -195 17 -11 40 -24 53 -30 54 -24 428 -280 452 -310 3 -4 28 -24 55 -46 132 -103 426 -397 515 -514 18 -25 39 -49 45 -55 11 -11 123 -159 140 -187 6 -9 33 -49 60 -90 28 -40 53 -80 58 -88 4 -8 16 -28 27 -45 11 -16 24 -39 30 -50 6 -11 26 -47 44 -80 66 -117 143 -280 196 -410 17 -44 38 -95 46 -113 8 -18 14 -41 14 -50 0 -10 4 -22 8 -28 12 -13 54 -147 95 -304 13 -51 22 -90 62 -280 8 -41 15 -88 15 -105 0 -16 7 -66 16 -110 13 -64 16 -155 17 -445 1 -370 -4 -443 -45 -650 -6 -30 -14 -80 -18 -110 -4 -30 -13 -77 -19 -105 -49 -193 -65 -251 -87 -303 -8 -18 -14 -41 -14 -52 0 -11 -6 -34 -14 -52 -8 -18 -21 -51 -29 -73 -34 -91 -65 -164 -122 -290 -7 -16 -16 -37 -19 -45 -3 -8 -10 -22 -15 -30 -5 -8 -12 -22 -15 -30 -3 -8 -10 -22 -15 -30 -5 -8 -12 -22 -15 -30 -4 -8 -16 -31 -27 -50 -12 -19 -32 -55 -46 -80 -30 -56 -37 -68 -90 -148 -24 -35 -43 -65 -43 -68 0 -12 -155 -218 -259 -343 -82 -99 -111 -132 -188 -210 -82 -84 -114 -99 -121 -56 -8 54 -122 316 -186 430 -12 22 -31 56 -42 75 -112 206 -365 510 -559 674 -44 38 -91 78 -105 90 -14 13 -38 31 -55 42 -16 10 -55 38 -87 61 -31 24 -59 43 -62 43 -3 0 -24 13 -48 29 -117 78 -452 241 -496 241 -8 0 -26 6 -40 14 -34 17 -86 35 -132 46 -19 5 -55 14 -80 20 -328 85 -624 108 -950 75 -165 -16 -252 -30 -326 -51 -28 -8 -61 -14 -73 -14 -12 0 -31 -5 -42 -10 -10 -6 -38 -15 -61 -19 -24 -5 -68 -19 -98 -31 -30 -12 -68 -25 -85 -30 -79 -21 -336 -144 -440 -211 -16 -10 -37 -22 -45 -26 -40 -19 -259 -178 -334 -242 -224 -192 -423 -427 -573 -677 -33 -55 -63 -106 -66 -114 -4 -8 -11 -22 -16 -30 -5 -8 -12 -22 -15 -30 -3 -8 -10 -22 -14 -30 -9 -14 -22 -43 -58 -127 -9 -21 -23 -51 -30 -66 -8 -16 -14 -35 -14 -42 0 -7 -6 -26 -14 -42 -19 -38 -46 -124 -46 -145 0 -42 -44 -14 -164 105 -68 67 -141 143 -162 168 -22 25 -57 68 -79 94 -22 26 -48 57 -59 69 -10 11 -28 37 -41 56 -12 19 -32 44 -44 54 -11 11 -21 23 -21 28 0 5 -20 36 -45 68 -25 32 -45 61 -45 64 0 2 -20 34 -45 70 -25 37 -45 68 -45 70 0 4 -76 138 -100 176 -9 15 -65 128 -81 165 -5 11 -13 27 -18 35 -10 19 -34 72 -56 130 -17 44 -27 67 -59 143 -9 21 -16 46 -16 55 0 10 -4 22 -8 28 -8 8 -25 58 -68 204 -21 72 -41 150 -57 230 -9 41 -23 109 -32 150 -8 41 -15 89 -15 105 0 17 -7 66 -16 110 -13 63 -16 155 -17 440 -2 370 7 498 49 682 8 34 14 76 14 92 0 16 5 42 11 58 6 15 15 51 20 78 7 43 22 98 59 220 5 17 16 53 24 80 18 60 35 110 52 150 7 17 27 66 44 110 49 123 159 354 209 435 11 19 25 44 31 55 6 11 19 34 30 50 11 17 23 37 27 45 3 8 19 31 35 51 15 20 28 39 28 42 0 9 89 137 139 200 25 32 66 84 91 116 63 80 106 126 255 276 184 183 193 191 412 361 70 54 165 121 211 149 9 6 36 23 60 38 23 15 59 37 80 48 20 11 51 29 67 39 62 39 416 210 434 210 5 0 22 6 38 14 26 13 66 29 153 61 19 7 62 21 95 30 33 10 78 24 100 30 115 36 233 65 300 75 28 4 73 12 100 18 72 15 263 41 380 51 114 10 497 6 660 -8z"/> <path d="M4370 6928 c-104 -11 -269 -51 -347 -84 -134 -57 -169 -74 -218 -104 -22 -13 -56 -33 -75 -43 -50 -27 -206 -156 -265 -218 -42 -44 -78 -90 -192 -245 -43 -57 -137 -266 -163 -359 -5 -16 -13 -43 -18 -60 -45 -132 -60 -499 -27 -654 21 -96 43 -177 61 -219 8 -18 14 -41 14 -50 0 -10 4 -22 9 -28 5 -5 19 -34 32 -64 112 -270 401 -573 674 -708 87 -43 161 -75 190 -83 17 -4 45 -12 63 -18 17 -6 47 -16 65 -21 63 -21 290 -50 385 -50 99 1 297 28 387 53 267 76 482 202 670 392 83 84 157 168 164 187 2 6 22 38 45 72 72 107 146 273 179 401 45 174 50 209 50 400 1 218 -19 341 -80 510 -26 72 -96 221 -128 273 -121 198 -282 364 -485 497 -62 41 -231 125 -252 125 -9 0 -19 4 -22 9 -3 4 -36 18 -73 29 -213 64 -418 84 -643 60z"/> </g> </svg> 
            <p id ="nom"></p>
        </div>
        
        <div id = "code-couleur">
            <h1>Choisissez votre medium</h1>
            <p id = "spirite"> Spirite</p>
            <p id = "astrologue">Astrologue</p>
            <p id = "cartomancien">Cartomancien</p>
        </div>
        
        
        <table id="listeMediums"></table>
        <div id="messagexBoxCustom">
            
            <h1 id="nomMediumConfirmBox"></h1>
            <p id="presentationMediumConfirmBox"></p>
            <button id="buttonRetour">Retour</button>
            <button id="buttonConsulter">Consulter</button>
            
        </div>
        
        
        
        
        <div id = banniere_bas class = "banniere">
            <p>Copyrigth 2024 Predict'IF - All rights reserved</p>
        </div>
        
        <script>
            let idMediumPourLaConsultation = null; // une fois la case clique, on met l id du medium en question qui se trouve dans lid de la case pour ensuite le passe au button confirm qui fait la requete ajax
            $("#buttonRetour").on("click", function() {
                // button retour sur la message box
                // on cache la message box
                $("#messageBoxCustom").toggle();
            }); 
            
            $("#buttonConsulter").on("click", function() {
                // envoyer une requet ajax avec lid du medium en question
              
                $.ajax({
                        url: './ActionServlet',
                        method: 'POST',
                        data: {
                            todo: 'prendreRdvConsultation',
                            idMedium: idMediumPourLaConsultation
                        },
                        dataType: 'json'
                    })
                    .done( function (response) { 
                        // TODO check si la consultation a bien ete prise, sinon notifier l utilisateur
                        console.log("Response: " + response.demandeConsultation);  
                        if(response.demandeConsultation) { 
                            alert("Votre demande a bien ete prise en compte. Vous avez pris un rendez vous"); 
                        } else {
                            alert("Erreur lors de la demande. Votre rendez vous n a pas abouti");
                        } 
                    })
                    .fail( function (error) { 
                        // TODO
                    })
                    .always( function () { // Fonction toujours appelée
                        // TODO
                    });
                $("#messageBoxCustom").toggle();
            });
            
            $(document).ready( function () {
                
                let xmlhttp_test = new XMLHttpRequest(); //Construction de la request
                xmlhttp_test.open("GET", "./ActionServlet?todo=verifconnected", true); //Lancer la requête
                
                xmlhttp_test.onreadystatechange = function() { //Handler pour la réponse
                    let DONE = 4, OK = 200;
                    if (xmlhttp_test.readyState === DONE && xmlhttp_test.status === OK) {
                        
                        let jsonResponse = JSON.parse(xmlhttp_test.responseText); //parsing du Json
                        
                        if (jsonResponse.connected === false)
                            window.location = "./pageprincipale.html";
                        
                    }
                };
                
                xmlhttp_test.send(null);
                
                
                let xmlhttp = new XMLHttpRequest(); //Construction de la request
                xmlhttp.open("GET", "./ActionServlet?todo=afficherListeMedium", true); //Lancer la requête
                
                xmlhttp.onreadystatechange = function() { //Handler pour la réponse
                    let DONE = 4, OK = 200;
                    if (xmlhttp.readyState === DONE && xmlhttp.status === OK) {
                        console.log("test");
                        let jsonResponse = JSON.parse(xmlhttp.responseText); //parsing du Json
                        
                        //Recuperation des JsonArray
                        // affichage de la liste des mediums
                        let table = $("#listeMediums"); // on get la table dans le document HTML
                        let listeMediums = jsonResponse.listeMediums; 
                        let cte = 0; // compteur pour le nombre de meduims par ligne
                        let ligne = $("<tr></tr>"); // une ligne dans le tableau
                        for(let i = 0; i < listeMediums.length; i++) { // pcq 3 mediums par ligne
                            let uneCase = $("<th></th>");
                            let div = $("<div class = 'medium'></div>");
                            let title = $("<h1></h1>");
                            let photo = $("<img>");
                            photo.attr("class", "photo-medium");
                            photo.attr("src", "./MediumIMG/Medium" + listeMediums[i].genre + (Math.floor(Math.random() * 5)+1) + ".jpg");
                            photo.attr("height", 300);
                            photo.attr("width", 300);
                            $(title).text(listeMediums[i].nom);
                            let presentation = $("<p></p>");
                            $(presentation).text(listeMediums[i].presentation);
                            div.append(photo);
                            div.append(title);
                            div.append(presentation);
                            $(div).attr('idMedium', listeMediums[i].id);
                            $(div).attr('type', listeMediums[i].type);// identifiant de la case est id du medium pour savoir quel medium est selectionne au clique
                            uneCase.append(div);
                            
                            div.on("click", function() {
                                // on veut que lorsqu un medium est clique, mettre son id qui est l id de l element uneCase dans la requete au cas ou l utilisateur demande un rdv avec le medium en question
                                tabData = ($(event.currentTarget)).children(); // fils de la case qui a ete cliquee
                                $("#messagexBoxCustom").show(); 
                                idMediumPourLaConsultation = $(div).attr("idMedium"); // on met l id du medium clique
                                $("#nomMediumConfirmBox").text($(tabData[0]).text());
                                $("#presentationMediumConfirmBox").text($(tabData[1]).text());                                
                            });
                            if(cte === 3) {
                                table.append(ligne); // on ajoute la ligne remplie au tableau
                                ligne = $("<tr></tr>"); // on reprend une nouvelle ligne
                                cte = 0; // reset le compteur
                            }
                            ligne.append(uneCase); // on ajoute la case a la ligne
                            cte++; // on met a jour le nombre de cases dans la ligne
                        }
                        table.append(ligne);
                    }
                };    
                xmlhttp.send(null);   
            });
        </script>
    </body>
</html>
