<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Consultation</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="./CSS/consultation.css" />
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>

    </head>
    <header>
        <nav>
            <h1>Predict'IF</h1>
            <h1>Consultation</h1>
            <div id='profilUtilisateur'></div>
        </nav>
    </header>
    <body>
        <div id="infoMedium">
            <p id="prenomMedium"></p>
        </div>
        
        <div id="infoClient">
            <table>
                <tr id="caseInfo">
                    <th>
                        <img src="" alt="photo de profile">
                    </th>
                    <th>
                        <div id="prenomClient"></div>
                        <div id="informationPersonnelles">
                            <p id="age"></p>
                            <p id="telephone"></p>
                            <p id="profilAstral"></p>
                        </div>
                    </th>
                    <th>
                        <a href="./historiqueclient.html">
                            <button id="historiqueClient" class="button">Historique client</button>
                        </a>
                        <button id="buttonPret" class="button">Pret</button>
                    </th>
                </tr>
                <tr>
                    <th>
                        <input type="range" id="amour" name="amour" min="1" max="4">
                        <p class="title">Amour</p>
                        <div class="score">
                            <div class="number">1</div>
                            <div class="number">2</div>
                            <div class="number">3</div>
                            <div class="number">4</div>
                        </div>
                    </th>
                    
                    <th>
                        <input type="range" id="sante" name="sante" min="1" max="4">
                        <div class="score">
                            <div class="number">1</div>
                            <div class="number">2</div>
                            <div class="number">3</div>
                            <div class="number">4</div>
                        </div>
                        <p class="title">Sante</p>
                    </th>
                    
                    <th>
                        <input type="range" id="travail" name="travail" min="1" max="4">
                        <p class="title">Travail</p>
                        <div class="score">
                            <div class="number">1</div>
                            <div class="number">2</div>
                            <div class="number">3</div>
                            <div class="number">4</div>
                        </div>
                    </th>                        
                </tr>
                <tr>
                    <th>
                        <button id="generer" class="button">Generer</button>
                        <button id="finConsultation" class="button">Finir consultation</button>
                    </th>
                    <th>
                        <div id="predAmour" class="predictions">Prediction en amour...</div>
                        <div id="predSante" class="predictions">Prediction sur la sante...</div>
                        <div id="predTravail" class="predictions">Prediction sur le travail...</div>
                    </th>
                </tr>
            </table>
        </div>
        
        <div id="popUp">
            <h1>Commentaire en fin de consultation</h1>
            <input required type="text" id="commentaire" name="commentaire" placeholder="Ecrivez votre commentaire ici...">
            <button id="envoyerCommentaire" class="button">Envoyer</button>
        </div>
        
    </body>
    <footer>
        <div id = banniere_bas class = "banniere">
            <p>Copyrigth 2024 Predict'IF - All rights reserved</p>
        </div>
        <div id="forTest">
            <input type="number" id="cons" name="cons">
            <button id="lancerTest">submit test</button>
        </div>
    </footer>
    
    <script>
        let idCons = null;
        let idClient = null;
        $("#popUp").hide(); // cacher la pop up au debut
        $("#lancerTest").on("click", function() {
            idCons = $("#cons").val(); // id de la consultation sur laquelle on fait les test
            console.log("la valeur de la consultation est : " + idCons);
            // on lance la requete ajax 
            $.ajax({
                url: './ActionServlet',
                method: 'POST',
                data: {
                    todo: 'pageConsultation',
                    idCons: idCons
                },
                dataType: 'json'
            })
            .done( function (response) { 
                console.log("Response: " + response.age);  
                let prenomMedium = response.prenomMedium;
                let prenomClient = response.prenomClient; 
                let ageClient = response.age;
                let telClient = response.tel;
                let profilClient = response.profilAstro.signeZodiaque + ", "+ response.profilAstro.signeChinois + ", " + response.profilAstro.couleurPorteBonheur + ", " + response.profilAstro.animalTotem;
                idClient = response.idClient; // mettre de cote pour d autre requetes
                
                $("#prenomMedium").text("Medium incarne: " + prenomMedium); 
                $("#prenomClient").text(prenomClient); 
                $("#age").text("Age: " + ageClient); 
                $("#telephone").text("Telephone: " + telClient); 
                $("#profilAstral").text("Profil Astral: " + profilClient); 
            });
        })
        
        
        $("#buttonPret").on("click", function() {
            console.log("debut de la consultation numero: " + idCons);
            $.ajax({
                url: './ActionServlet',
                method: 'POST',
                data: {
                    todo: 'signalerClient',
                    idCons: idCons
                },
                dataType: 'json'
            });
        })
        
        $("#generer").on("click", function() {
            let amour = $("#amour").val();
            let sante = $("#sante").val();
            let travail = $("#travail").val();
            console.log("button generer prediction clicked test 2");

            // on lance la requete ajax 
            $.ajax({
                url: './ActionServlet',
                method: 'POST',
                data: {
                    todo: 'generationPrediction',
                    idClient: idClient,
                    amour: amour,
                    sante: sante,
                    travail: travail
                },
                dataType: 'json'
            })
            .done( function (response) {
                console.log("Generation de prediction: " + response);
                let amour = response.amour; 
                let sante = response.sante;
                let travail = response.travail;
                
                $("#predAmour").text(amour);
                $("#predSante").text(sante);
                $("#predTravail").text(travail);                
            });
        })
        
        $("#finConsultation").on("click", function() {
            console.log("fin de la consultation, button actif test 2");
            $.ajax({
                url: './ActionServlet',
                method: 'POST',
                data: {
                    todo: 'finConsultation',
                    idCons: idCons
                },
                dataType: 'json'
            })
            .done(function(response) {
                console.log("fin de la consultation, affichage du pop up");
                $("#popUp").show();
            });
        })
        
        $("#envoyerCommentaire").on("click", function() {
            console.log("button envouer commentaire active");
            let commentaire = $("#commentaire").val(); // on recupere le commentaire
            $.ajax({
                url: './ActionServlet',
                method: 'POST',
                data: {
                    todo: 'envoyerCommentaire',
                    idCons: idCons, 
                    commentaire: commentaire
                },
                dataType: 'json'
            })
            .done(function(response) {
                console.log("envoi du commentaire enregistre");
                // redirection vers la page
                window.location.href = "./dashboard_employe.html";
            });
        })
        
        
         
    </script>
</html>
